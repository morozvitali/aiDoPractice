ðŸš€ ÐœÐ¾Ð´ÑƒÐ»ÑŒ â„–11 â€” Concurrency & Parallel Streams Deep Dive
(Ð§Ð°ÑÑ‚Ð¸Ð½Ð° 1: Threads â€” Ð¾ÑÐ½Ð¾Ð²Ð¸ Ð±Ð°Ð³Ð°Ñ‚Ð¾Ð¿Ð¾Ñ‚Ð¾Ñ‡Ð½Ð¾ÑÑ‚Ñ–)

Ð¦Ðµ Ð½Ð°Ð¹Ð²Ð°Ð¶Ð»Ð¸Ð²Ñ–ÑˆÐ° Ð¾ÑÐ½Ð¾Ð²Ð°: Ñ‚ÑƒÑ‚ Ð¼Ð¸ ÑÑ‚Ð²Ð¾Ñ€Ð¸Ð¼Ð¾ ÑÐ²Ð¾Ñ— Ð¿Ð¾Ñ‚Ð¾ÐºÐ¸,
Ð¿Ð¾Ð±Ð°Ñ‡Ð¸Ð¼Ð¾ race condition, Ð½Ð°Ð²Ñ‡Ð¸Ð¼Ð¾ÑÑŒ ÐºÐµÑ€ÑƒÐ²Ð°Ñ‚Ð¸ Ð¿Ð¾Ñ€ÑÐ´ÐºÐ¾Ð¼
Ð²Ð¸ÐºÐ¾Ð½Ð°Ð½Ð½Ñ, Ñ– Ð²Ñ–Ð´Ñ‡ÑƒÑ”Ð¼Ð¾, ÑÐº Ð¼Ð¸ÑÐ»Ð¸Ñ‚ÑŒ JVM Ð¿Ñ–Ð´ Ð½Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶ÐµÐ½Ð½ÑÐ¼.

âš™ï¸ Ð§Ð°ÑÑ‚Ð¸Ð½Ð° 1 â€” Threads Basics (Ð—Ð°Ð²Ð´Ð°Ð½Ð½Ñ 1â€“5)
âœ… Ð—Ð°Ð²Ð´Ð°Ð½Ð½Ñ 1 â€” Ð¡Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ Ñ‚Ð° Ð·Ð°Ð¿ÑƒÑÐº Ð¿Ð¾Ñ‚Ð¾ÐºÑƒ (Thread + Runnable)

# Runnable â€” Ñ†Ðµ Ñ„ÑƒÐ½ÐºÑ†Ñ–Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¸Ð¹ Ñ–Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ Ð² Java,
# ÑÐºÐ¸Ð¹ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÑ”Ñ‚ÑŒÑÑ Ð´Ð»Ñ Ð¾Ð¿Ð¸ÑÑƒ Ð·Ð°Ð´Ð°Ñ‡Ñ–,
# Ñ‰Ð¾ Ð¼Ð¾Ð¶Ðµ Ð²Ð¸ÐºÐ¾Ð½ÑƒÐ²Ð°Ñ‚Ð¸ÑÑ Ð² Ð¾ÐºÑ€ÐµÐ¼Ð¾Ð¼Ñƒ Ð¿Ð¾Ñ‚Ð¾Ñ†Ñ– (thread). 
# Ð’Ñ–Ð½ Ð·Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑŒÑÑ Ð² Ð¿Ð°ÐºÐµÑ‚Ñ– java.lang Ñ– Ð²Ð¸Ð³Ð»ÑÐ´Ð°Ñ” Ñ‚Ð°Ðº:

@FunctionalInterface
public interface Runnable {
void run();
}

# Runnable â€” Ñ†Ðµ ÑÐº ÐºÐ¾Ð½Ñ‚Ñ€Ð°ÐºÑ‚: Â«Ñ†ÐµÐ¹ Ð¾Ð±â€™Ñ”ÐºÑ‚ Ð¼Ð¾Ð¶Ð½Ð° Ð²Ð¸ÐºÐ¾Ð½Ð°Ñ‚Ð¸ Ð² Ð¿Ð¾Ñ‚Ð¾Ñ†Ñ–Â».
https://chatgpt.com/c/69033f9c-b7a0-832f-986b-abe7f6a202f2 


ðŸ“‹ Ð£Ð¼Ð¾Ð²Ð°: ÑÑ‚Ð²Ð¾Ñ€Ð¸Ñ‚Ð¸ Ð½Ð¾Ð²Ð¸Ð¹ Ð¿Ð¾Ñ‚Ñ–Ðº, ÑÐºÐ¸Ð¹ Ð²Ð¸Ð²ÐµÐ´Ðµ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ 5 Ñ€Ð°Ð·Ñ–Ð².

public class Task1 {
public static void main(String[] args) {
Runnable job = () -> {
for (int i = 1; i <= 5; i++) {
System.out.println(Thread.currentThread().getName() + " â†’ " + i);
}
};
        // Ñ€ÐµÐ°Ð»Ñ–Ð·Ð°Ñ†Ñ–Ñ Runnable Ñ‡ÐµÑ€ÐµÐ· ÐºÐ»Ð°Ñ
        Thread t = new Thread(job);
        t.start();

        System.out.println("Main thread finished setup.");
    }
}


ðŸ“¤ ÐŸÑ€Ð¸ÐºÐ»Ð°Ð´ Ð²Ð¸Ð²Ð¾Ð´Ñƒ:

Main thread finished setup.
Thread-0 â†’ 1
Thread-0 â†’ 2
Thread-0 â†’ 3
Thread-0 â†’ 4
Thread-0 â†’ 5


ðŸ§  ÐŸÐ¾ÑÑÐ½ÐµÐ½Ð½Ñ:

t.start() Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ” Ð½Ð¾Ð²Ð¸Ð¹ Ð¿Ð¾Ñ‚Ñ–Ðº Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð¾, Ð½Ðµ Ð±Ð»Ð¾ÐºÑƒÑ” main.

Ð’Ð¸ÐºÐ¾Ð½Ð°Ð½Ð½Ñ main Ñ– Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð¿Ð¾Ñ‚Ð¾ÐºÑƒ Ð¼Ð¾Ð¶Ðµ Ð¿ÐµÑ€ÐµÐ¼Ñ–ÑˆÑƒÐ²Ð°Ñ‚Ð¸ÑÑŒ.

âœ… Ð—Ð°Ð²Ð´Ð°Ð½Ð½Ñ 2 â€” Ð’Ñ–Ð´Ð¼Ñ–Ð½Ð½Ñ–ÑÑ‚ÑŒ Ð¼Ñ–Ð¶ start() Ñ– run()

ðŸ“‹ Ð£Ð¼Ð¾Ð²Ð°: Ð¿ÐµÑ€ÐµÐ²Ñ–Ñ€ Ñ€Ñ–Ð·Ð½Ð¸Ñ†ÑŽ Ð¼Ñ–Ð¶ Ð²Ð¸ÐºÐ»Ð¸ÐºÐ¾Ð¼ .start() Ñ– .run().

Thread t = new Thread(() -> System.out.println(Thread.currentThread().getName()));
t.run();   // âŒ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð²Ð¸ÐºÐ»Ð¸Ðº Ð¼ÐµÑ‚Ð¾Ð´Ñƒ
t.start(); // âœ… ÑÑ‚Ð²Ð¾Ñ€ÑŽÑ” Ð½Ð¾Ð²Ð¸Ð¹ Ð¿Ð¾Ñ‚Ñ–Ðº


ðŸ“¤ Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:

main
Thread-0


ðŸ§  run() Ð²Ð¸ÐºÐ¾Ð½ÑƒÑ”Ñ‚ÑŒÑÑ Ð² Ñ‚Ð¾Ð¼Ñƒ Ð¶ Ð¿Ð¾Ñ‚Ð¾Ñ†Ñ– (main),
Ð° start() ÑÑ‚Ð²Ð¾Ñ€ÑŽÑ” Ð½Ð¾Ð²Ð¸Ð¹ â€” Ñ–Ð· Ð²Ð»Ð°ÑÐ½Ð¸Ð¼ ÑÑ‚ÐµÐºÐ¾Ð¼ Ð²Ð¸ÐºÐ¾Ð½Ð°Ð½Ð½Ñ.

âœ… Ð—Ð°Ð²Ð´Ð°Ð½Ð½Ñ 3 â€” ÐœÐµÑ‚Ð¾Ð´ sleep() Ñ– Ð·Ð°Ñ‚Ñ€Ð¸Ð¼ÐºÐ° Ð²Ð¸ÐºÐ¾Ð½Ð°Ð½Ð½Ñ

ðŸ“‹ Ð£Ð¼Ð¾Ð²Ð°: Ð·Ð°Ñ‚Ñ€Ð¸Ð¼Ð°Ð¹ Ð¿Ð¾Ñ‚Ñ–Ðº Ð½Ð° 500 Ð¼Ñ Ð¼Ñ–Ð¶ ÐºÑ€Ð¾ÐºÐ°Ð¼Ð¸.

Thread t = new Thread(() -> {
try {
for (int i = 1; i <= 3; i++) {
System.out.println("Step " + i);
Thread.sleep(500);
}
} catch (InterruptedException e) {
e.printStackTrace();
}
});

t.start();


ðŸ“¤ Ð’Ð¸Ð²Ñ–Ð´ (Ð· Ð¿Ð°ÑƒÐ·Ð°Ð¼Ð¸):

Step 1
(0.5s pause)
Step 2
(0.5s pause)
Step 3


ðŸ§  Thread.sleep() Ð¿Ñ€Ð¸Ð·ÑƒÐ¿Ð¸Ð½ÑÑ” Ð¿Ð¾Ñ‚Ñ–Ðº, Ð°Ð»Ðµ Ð½Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÑƒÑ” Ð¹Ð¾Ð³Ð¾. Ð†Ð½ÑˆÑ– Ð¿Ð¾Ñ‚Ð¾ÐºÐ¸ Ð¼Ð¾Ð¶ÑƒÑ‚ÑŒ Ð¿Ñ€Ð°Ñ†ÑŽÐ²Ð°Ñ‚Ð¸ Ð´Ð°Ð»Ñ–.

âœ… Ð—Ð°Ð²Ð´Ð°Ð½Ð½Ñ 4 â€” Race condition (Ð·Ñ–Ñ‚ÐºÐ½ÐµÐ½Ð½Ñ Ð¿Ð¾Ñ‚Ð¾ÐºÑ–Ð²)

ðŸ“‹ Ð£Ð¼Ð¾Ð²Ð°: Ð¿Ð¾ÐºÐ°Ð¶Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñƒ, ÐºÐ¾Ð»Ð¸ Ð´Ð²Ð° Ð¿Ð¾Ñ‚Ð¾ÐºÐ¸ Ð·Ð¼Ñ–Ð½ÑŽÑŽÑ‚ÑŒ ÑÐ¿Ñ–Ð»ÑŒÐ½Ñƒ Ð·Ð¼Ñ–Ð½Ð½Ñƒ.

public class RaceConditionDemo {
static int counter = 0;

    public static void main(String[] args) throws InterruptedException {
        Runnable task = () -> {
            for (int i = 0; i < 1000; i++) counter++;
        };

        Thread t1 = new Thread(task);
        Thread t2 = new Thread(task);
        t1.start();
        t2.start();
        t1.join();
        t2.join();

        System.out.println("Counter = " + counter);
    }
}


ðŸ“¤ ÐžÑ‡Ñ–ÐºÑƒÑ”Ñˆ: 2000
ðŸ“‰ ÐžÑ‚Ñ€Ð¸Ð¼ÑƒÑ”Ñˆ: 1784, 1922, 2000... (Ð²Ð¸Ð¿Ð°Ð´ÐºÐ¾Ð²Ð¾ ÐºÐ¾Ð¶ÐµÐ½ Ñ€Ð°Ð·!)

ðŸ§  Ð¦Ðµ Ñ– Ñ” race condition â€” Ð¾Ð±Ð¸Ð´Ð²Ð° Ð¿Ð¾Ñ‚Ð¾ÐºÐ¸ Ñ‡Ð¸Ñ‚Ð°ÑŽÑ‚ÑŒ Ñ– Ð·Ð¼Ñ–Ð½ÑŽÑŽÑ‚ÑŒ Ð·Ð¼Ñ–Ð½Ð½Ñƒ Ð¾Ð´Ð½Ð¾Ñ‡Ð°ÑÐ½Ð¾, Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿Ð¸ÑÑƒÑŽÑ‡Ð¸ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚.

âœ… Ð—Ð°Ð²Ð´Ð°Ð½Ð½Ñ 5 â€” synchronized Ð±Ð»Ð¾ÐºÑƒÑ” Ð¾Ð´Ð½Ð¾Ñ‡Ð°ÑÐ½Ð¸Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿

ðŸ“‹ Ð£Ð¼Ð¾Ð²Ð°: Ð²Ð¸Ð¿Ñ€Ð°Ð² race condition Ð·Ð° Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð¾ÑŽ synchronized.

public class SyncDemo {
static int counter = 0;

    public static synchronized void increment() {
        counter++;
    }

    public static void main(String[] args) throws InterruptedException {
        Runnable task = () -> {
            for (int i = 0; i < 1000; i++) increment();
        };

        Thread t1 = new Thread(task);
        Thread t2 = new Thread(task);
        t1.start();
        t2.start();
        t1.join();
        t2.join();

        System.out.println("Counter = " + counter);
    }
}


ðŸ“¤ Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ ÑÑ‚Ð°Ð±Ñ–Ð»ÑŒÐ½Ð¸Ð¹:

Counter = 2000


ðŸ§  synchronized Ð³Ð°Ñ€Ð°Ð½Ñ‚ÑƒÑ”, Ñ‰Ð¾ Ð»Ð¸ÑˆÐµ Ð¾Ð´Ð¸Ð½ Ð¿Ð¾Ñ‚Ñ–Ðº Ð¾Ð´Ð½Ð¾Ñ‡Ð°ÑÐ½Ð¾ Ð²Ð¸ÐºÐ¾Ð½ÑƒÑ” Ð¼ÐµÑ‚Ð¾Ð´ increment().

ðŸ§© ÐŸÑ–Ð´ÑÑƒÐ¼Ð¾Ðº Ñ‡Ð°ÑÑ‚Ð¸Ð½Ð¸ 1
Ð¢ÐµÐ¼Ð°	ÐœÐµÑ‚Ð¾Ð´ / ÐšÐ¾Ð½Ñ†ÐµÐ¿Ñ†Ñ–Ñ	Ð©Ð¾ Ñ€Ð¾Ð±Ð¸Ñ‚ÑŒ
Ð¡Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ Ð¿Ð¾Ñ‚Ð¾ÐºÑƒ	new Thread(Runnable)	Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ” Ð½Ð¾Ð²Ð¸Ð¹ Ð¿Ð¾Ñ‚Ñ–Ðº
Ð—Ð°Ð¿ÑƒÑÐº	.start() vs .run()	start ÑÑ‚Ð²Ð¾Ñ€ÑŽÑ” Ð½Ð¾Ð²Ð¸Ð¹ Ð¿Ð¾Ñ‚Ñ–Ðº
Ð—Ð°Ñ‚Ñ€Ð¸Ð¼ÐºÐ°	Thread.sleep(ms)	Ð¿Ñ€Ð¸Ð·ÑƒÐ¿Ð¸Ð½ÑÑ” Ð¿Ð¾Ñ‚Ñ–Ðº
Ð—Ñ–Ñ‚ÐºÐ½ÐµÐ½Ð½Ñ	Race condition	ÐºÑ–Ð»ÑŒÐºÐ° Ð¿Ð¾Ñ‚Ð¾ÐºÑ–Ð² Ð·Ð¼Ñ–Ð½ÑŽÑŽÑ‚ÑŒ Ð¾Ð´Ð½Ñ– Ð´Ð°Ð½Ñ–
Ð‘Ð»Ð¾ÐºÑƒÐ²Ð°Ð½Ð½Ñ	synchronized	Ð¾Ð±Ð¼ÐµÐ¶ÑƒÑ” Ð¾Ð´Ð½Ð¾Ñ‡Ð°ÑÐ½Ð¸Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿

ðŸ§  ÐŸÑ–ÑÐ»Ñ Ñ†ÑŒÐ¾Ð³Ð¾ Ð±Ð»Ð¾ÐºÑƒ Ñ‚Ð¸ Ð²Ð¶Ðµ Ð²Ð¼Ñ–Ñ”Ñˆ:

ÑÑ‚Ð²Ð¾Ñ€ÑŽÐ²Ð°Ñ‚Ð¸ Ñ– Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚Ð¸ Ð¿Ð¾Ñ‚Ð¾ÐºÐ¸;

ÐºÐµÑ€ÑƒÐ²Ð°Ñ‚Ð¸ Ñ—Ñ… Ð¶Ð¸Ñ‚Ñ‚Ñ”Ð²Ð¸Ð¼ Ñ†Ð¸ÐºÐ»Ð¾Ð¼;

Ñ€Ð¾Ð·ÑƒÐ¼Ñ–Ñ”Ñˆ, Ñ‡Ð¾Ð¼Ñƒ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ñ–Ð·Ð°Ñ†Ñ–Ñ.

ðŸ‘‰ ÐÐ°ÑÑ‚ÑƒÐ¿Ð½Ð° Ñ‡Ð°ÑÑ‚Ð¸Ð½Ð° (2ï¸âƒ£) â€” Locks & Atomics:
Ð¢Ð°Ð¼ Ð¼Ð¸ Ð¿Ð¾Ð´Ð¸Ð²Ð¸Ð¼Ð¾ÑÑŒ:

ÑÐº ReentrantLock Ð´Ð°Ñ” Ð±Ñ–Ð»ÑŒÑˆÐµ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŽ Ð½Ñ–Ð¶ synchronized,

ÑÐº AtomicInteger Ð¿Ñ€Ð¸Ð±Ð¸Ñ€Ð°Ñ” Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ñƒ Ð² Ð±Ð»Ð¾ÐºÑƒÐ²Ð°Ð½Ð½ÑÑ…,

Ñ– Ñ‰Ð¾ Ð²Ñ–Ð´Ð±ÑƒÐ²Ð°Ñ”Ñ‚ÑŒÑÑ, ÐºÐ¾Ð»Ð¸ Ð¿Ð¾Ñ‚Ñ–Ðº Ð·Ð°Ð²Ð¸ÑÐ°Ñ” Ñƒ lock-ÑÑ‚Ð°Ð½Ñ–.