–î–æ–¥–∞—Ç–∏ —â–µ –∫—ñ–ª—å–∫–∞ –∑–∞–≤–¥–∞–Ω—å
----------------c-o-l-l-e-c-t-i-n-g-A-n-d-T-h-e-n-------------------


üß™ –ó–∞–≤–¥–∞–Ω–Ω—è: collectingAndThen 
üéØ –ó–∞–¥–∞—á–∞:
–ú–∞—î–º–æ —Å–ø–∏—Å–æ–∫ —á–∏—Å–µ–ª
–í–∏–±—Ä–∞—Ç–∏ —Ç—ñ, —â–æ > 50
–í—ñ–¥—Å–æ—Ä—Ç—É–≤–∞—Ç–∏ –∑–∞ —Å–ø–∞–¥–∞–Ω–Ω—è–º
–ó—ñ–±—Ä–∞—Ç–∏ –≤ –Ω–µ–∑–º—ñ–Ω–Ω–∏–π —Å–ø–∏—Å–æ–∫ (List<Integer>)
–ü–æ–≤–µ—Ä–Ω—É—Ç–∏ –π–æ–≥–æ

üì• –í—Ö—ñ–¥:

List<Integer> numbers = List.of(10, 70, 20, 90, 55, 30);
üì§ –û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

[90, 70, 55]
(—ñ —Å–ø–∏—Å–æ–∫ –º–∞—î –±—É—Ç–∏ –Ω–µ–º–æ–¥–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π)



üîß –®–∞–±–ª–æ–Ω:
public List<Integer> sortedUnmodifiable() {
List<Integer> numbers = List.of(10, 70, 20, 90, 55, 30);

    return numbers.stream()
            .filter(n -> n > 50)
            .sorted(Comparator.reverseOrder())
            .collect(Collectors.collectingAndThen(
                Collectors.toList(),
                Collections::unmodifiableList
            ));
}
üåÄ –¢–≤–æ—î –∑–∞–≤–¥–∞–Ω–Ω—è:

–ù–∞–ø–∏—à–∏ —Å–≤—ñ–π –º–µ—Ç–æ–¥ –Ω–∞ –±–∞–∑—ñ —Ü—å–æ–≥–æ

–ê–±–æ —Å—Ç–≤–æ—Ä–∏ —Å–≤—ñ–π –ø—Ä–∏–∫–ª–∞–¥: –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∑—ñ–±—Ä–∞—Ç–∏ –≤—Å—ñ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ
—Å–ª–æ–≤–∞ –¥–æ–≤–∂–∏–Ω–æ—é > 4 –≤ –Ω–µ–∑–º—ñ–Ω–Ω–∏–π —Å–ø–∏—Å–æ–∫



?--?--?--?--?--?--?--?--THEORY--?--?--?--?--?--?--?--?

üß† –¢–µ–º–∞: collectingAndThen ‚Äî –∑–±–∏—Ä–∞–π —ñ –æ–¥—Ä–∞–∑—É –ø–µ—Ä–µ—Ç–≤–æ—Ä—é–π
üìå –©–æ —Ü–µ —Ç–∞–∫–µ?
–¶–µ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π –∫–æ–ª–µ–∫—Ç–æ—Ä, —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î:

–°–ø–æ—á–∞—Ç–∫—É –∑—ñ–±—Ä–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —É List, Set, Map‚Ä¶

–ê –ø–æ—Ç—ñ–º –≤—ñ–¥—Ä–∞–∑—É –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ –π–æ–≥–æ, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥,
–∑—Ä–æ–±–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ –Ω–µ–∑–º—ñ–Ω–Ω–∏–º, –∞–±–æ –æ–±–≥–æ—Ä–Ω—É—Ç–∏ –≤ —ñ–Ω—à—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É.

üì¶ –°–∏–Ω—Ç–∞–∫—Å–∏—Å:
Collectors.collectingAndThen(
Collector<T, A, R> downstream,
Function<R, RR> finisher
)
–ü–µ—Ä–µ–∫–ª–∞–¥–∞—é—á–∏ –∑ ‚Äú–¥–∂–∞–≤—ñ–π—Å—å–∫–æ—ó‚Äù:
—Å–ø–æ—á–∞—Ç–∫—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π Collector (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ toList())
–∞ –ø–æ—Ç—ñ–º –∑–∞—Å—Ç–æ—Å—É–π —Ñ—É–Ω–∫—Ü—ñ—é –¥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥
Collections::unmodifiableList)

üîß –ü—Ä–∏–∫–ª–∞–¥:
List<String> result = Stream.of("apple", "banana", "cherry")
.filter(w -> w.length() > 5)
.collect(Collectors.collectingAndThen(
Collectors.toList(),
Collections::unmodifiableList
));
üßä –¢–æ–±—Ç–æ: –º–∏ –∑—ñ–±—Ä–∞–ª–∏ –≤ List, –∞ –ø–æ—Ç—ñ–º –æ–¥—Ä–∞–∑—É –∑—Ä–æ–±–∏–ª–∏ –π–æ–≥–æ –Ω–µ–∑–º—ñ–Ω–Ω–∏–º.



------------------------
–¢–∞–∫, —Ä–æ–∑—É–º—ñ—é, collectingAndThen –ø—Ä–∞—Ü—é—î —è–∫ Colectors
–∞–ª–µ –ø—ñ—Å–ª—è –∑–±–∏—Ä–∞–Ω–Ω—è —É –∫–æ–ª–µ–∫—Ü—ñ—é –º–æ–∂–µ –∑—Ä–æ–±–∏—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—É –¥—ñ—é –∑ –∫–æ–ª–µ–∫—Ü—ñ—î—é.
–ê —è–∫—ñ –¥—ñ—ó –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∞–±–æ —á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è?
------------------------


üî• collectingAndThen = –∑–±–∏—Ä–∞–Ω–Ω—è (Collector) + –¥–æ–¥–∞—Ç–∫–æ–≤–∞ –¥—ñ—è (—Ñ—É–Ω–∫—Ü—ñ—è) –ø—ñ—Å–ª—è –∫–æ–ª–µ–∫—Ü—ñ–æ–Ω—É–≤–∞–Ω–Ω—è.

üéØ –Ü–¥–µ—è:
–¢–∏ —â–æ—Å—å –∑—ñ–±—Ä–∞–≤ (toList(), toSet(), groupingBy()),
–∞ –ø–æ—Ç—ñ–º ‚Äî ‚Äú–¥–æ–≤—ñ–≤ –¥–æ –∫–æ–Ω–¥–∏—Ü—ñ—ó‚Äù: –∑—Ä–æ–±–∏–≤ –∫–æ–ª–µ–∫—Ü—ñ—é –Ω–µ–∑–º—ñ–Ω–Ω–æ—é, –≤–∏—Ç—è–≥–Ω—É–≤ –∑–Ω–∞—á–µ–Ω–Ω—è, –æ–±–≥–æ—Ä–Ω—É–≤ —É —â–æ—Å—å —Ç–æ—â–æ.

üîß –ß–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω—ñ –¥—ñ—ó (—Ñ—É–Ω–∫—Ü—ñ—ó) –ø—ñ—Å–ª—è –∑–±–∏—Ä–∞–Ω–Ω—è
üí° –§—É–Ω–∫—Ü—ñ—è	üß† –©–æ —Ä–æ–±–∏—Ç—å	üìå –ü—Ä–∏–∫–ª–∞–¥
Collections::unmodifiableList	—Ä–æ–±–∏—Ç—å —Å–ø–∏—Å–æ–∫ –Ω–µ–∑–º—ñ–Ω–Ω–∏–º	—Å–ø–∏—Å–æ–∫ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è, –±–µ–∑ add()
List::size	–ø–æ–≤–µ—Ä—Ç–∞—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å –µ–ª–µ–º–µ–Ω—Ç—ñ–≤	–∑—ñ–±—Ä–∞–ª–∏ —Å–ø–∏—Å–æ–∫ ‚Üí –ø–æ—Ä–∞—Ö—É–≤–∞–ª–∏
Function.identity()	–ø—Ä–æ—Å—Ç–æ –ø–æ–≤–µ—Ä—Ç–∞—î —Ç–µ, —â–æ –∑—ñ–±—Ä–∞–ª–∏	—ñ–Ω–æ–¥—ñ –∫–æ—Ä–∏—Å–Ω–æ
Map::size	—Ä–æ–∑–º—ñ—Ä –º–∞–ø–∏	–ø—ñ—Å–ª—è groupingBy
Set::iterator().next()	–ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –ø–µ—Ä—à–∏–π –µ–ª–µ–º–µ–Ω—Ç –∑ Set	—è–∫—â–æ –∑—ñ–±—Ä–∞–ª–∏ —É Set, –∞–ª–µ —Ö–æ—á–µ–º–æ –æ–¥–∏–Ω
list -> list.get(0)	–ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –ø–µ—Ä—à–∏–π –µ–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫—É	—è–∫—â–æ —Ç–æ—á–Ω–æ –∑–Ω–∞—î–º–æ, —â–æ –Ω–µ –ø–æ—Ä–æ–∂–Ω—ñ–π
Optional::get	—è–∫—â–æ –∑–±–∏—Ä–∞—î–º–æ —â–æ—Å—å –≤ Optional ‚Äî –≤–∏—Ç—è–≥—É—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è
üìå –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏:
‚úÖ 1. –ó—Ä–æ–±–∏—Ç–∏ List –Ω–µ–∑–º—ñ–Ω–Ω–∏–º:

.collect(Collectors.collectingAndThen(
Collectors.toList(),
Collections::unmodifiableList
));
‚úÖ 2. –û—Ç—Ä–∏–º–∞—Ç–∏ —Ä–æ–∑–º—ñ—Ä —Å–ø–∏—Å–∫—É –ø—ñ—Å–ª—è –∑–±–∏—Ä–∞–Ω–Ω—è:

.collect(Collectors.collectingAndThen(
Collectors.toList(),
List::size
)); // –ø–æ–≤–µ—Ä–Ω–µ Integer
‚úÖ 3. –ü–æ–≤–µ—Ä–Ω—É—Ç–∏ –ø–µ—Ä—à–∏–π –µ–ª–µ–º–µ–Ω—Ç –ø—ñ—Å–ª—è —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è:

.collect(Collectors.collectingAndThen(
Collectors.toList(),
list -> list.get(0)
));
‚ö† –ê–ª–µ —Ç—É—Ç —Ç—Ä–µ–±–∞ –±—É—Ç–∏ –≤–ø–µ–≤–Ω–µ–Ω–∏–º, —â–æ —Å–ø–∏—Å–æ–∫ –Ω–µ –ø–æ—Ä–æ–∂–Ω—ñ–π, —ñ–Ω–∞–∫—à–µ –±—É–¥–µ IndexOutOfBoundsException

‚úÖ 4. –ó—ñ–±—Ä–∞—Ç–∏ Set, –ø–æ—Ç—ñ–º –≤–∏—Ç—è–≥–Ω—É—Ç–∏ –ø–µ—Ä—à–∏–π –µ–ª–µ–º–µ–Ω—Ç:

.collect(Collectors.collectingAndThen(
Collectors.toSet(),
set -> set.iterator().next()
));
‚ú® –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É –∫–æ–¥—ñ:
–†–æ–±–∏—Ç–∏ –∫–æ–ª–µ–∫—Ü—ñ—ó read-only –¥–ª—è —Å–µ—Ä–≤—ñ—Å—ñ–≤

–ü—ñ—Å–ª—è groupingBy –æ–¥—Ä–∞–∑—É –æ–±—á–∏—Å–ª–∏—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –º–µ—Ç—Ä–∏–∫–∏ (—Ä–æ–∑–º—ñ—Ä–∏, –º–∞–∫—Å–∏–º—É–º–∏ —Ç–æ—â–æ)

–ü–æ–≤–µ—Ä–Ω—É—Ç–∏ –ø–µ—Ä—à–∏–π –∞–±–æ —î–¥–∏–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç

–ü—ñ—Å–ª—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –π —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –Ω–∞–π–∫—Ä–∞—â–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç

üéÅ –•–æ—á–µ—à?
–ú–æ–∂—É –¥–∞—Ç–∏ —Ç–æ–±—ñ —Ç—Ä–µ–Ω–∞–∂–µ—Ä:

"–©–æ –±—É–¥–µ, —è–∫—â–æ‚Ä¶ collectingAndThen ‚Üí get(0)?"
"–Ø–∫ –∑—Ä–æ–±–∏—Ç–∏ Map<K, List<V>> –Ω–µ–∑–º—ñ–Ω–Ω–æ—é?"
"–Ø–∫ –≤–∏—Ç—è–≥–Ω—É—Ç–∏ top-1 –∑—ñ —Å–ø–∏—Å–∫—É –ø—ñ—Å–ª—è —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –±–µ–∑ .get()?"
