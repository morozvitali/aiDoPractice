https://chatgpt.com/g/g-p-68e8fbae40bc819189c46e34e72bb031-java-mentor/c/69032299-ca90-8328-8400-5ab42ae2bebe  

üßµ THREADS MODULE 05 ‚Äî Synchronizers (Semaphore, CountDownLatch, CyclicBarrier, Phaser)

üéØ –ú–µ—Ç–∞ –º–æ–¥—É–ª—è:
–ù–∞–≤—á–∏—Ç–∏—Å—è –∫–µ—Ä—É–≤–∞—Ç–∏ –≤–∑–∞—î–º–æ–∑–∞–ª–µ–∂–Ω–∏–º–∏ –ø–æ—Ç–æ–∫–∞–º–∏: –¥–æ–∑–≤–æ–ª—è—Ç–∏, –±–ª–æ–∫—É–≤–∞—Ç–∏, —á–µ–∫–∞—Ç–∏ –Ω–∞ —Å—Ç–∞—Ä—Ç, —É–∑–≥–æ–¥–∂—É–≤–∞—Ç–∏ —Ñ–∞–∑–∏.
–†–æ–∑—ñ–±—Ä–∞—Ç–∏—Å—è, –∫–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–µ–Ω Semaphore, –∫–æ–ª–∏ CountDownLatch, –∞ –∫–æ–ª–∏ ‚Äî CyclicBarrier —á–∏ Phaser.

‚úÖ –ó–∞–≤–¥–∞–Ω–Ω—è 1: SemaphoreParking ‚Äî –ü–∞—Ä–∫—ñ–Ω–≥ —ñ–∑ –æ–±–º–µ–∂–µ–Ω–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é –º—ñ—Å—Ü—å

üìã –£–º–æ–≤–∞:
–Ñ 3 –ø–∞—Ä–∫–æ–º—ñ—Å—Ü—è –π 6 –º–∞—à–∏–Ω.
–ö–æ–∂–Ω–∞ –º–∞—à–∏–Ω–∞ ‚Äú–ø–∞—Ä–∫—É—î—Ç—å—Å—è‚Äù (—Å–ø–∏—Ç—å 2 —Å–µ–∫—É–Ω–¥–∏), –ø–æ—Ç—ñ–º –∑–≤—ñ–ª—å–Ω—è—î –º—ñ—Å—Ü–µ.
–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π Semaphore(3) –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é –¥–æ—Å—Ç—É–ø—É.

üîß –ü—ñ–¥–∫–∞–∑–∫–∞:

Semaphore parking = new Semaphore(3);

Runnable car = () -> {
try {
parking.acquire();
System.out.println(Thread.currentThread().getName() + " parked");
Thread.sleep(2000);
} catch (InterruptedException e) {}
finally {
parking.release();
System.out.println(Thread.currentThread().getName() + " left");
}
};


üí° –ú–µ—Ç–∞:
–ü–æ–±–∞—á–∏—Ç–∏, —è–∫ Semaphore –æ–±–º–µ–∂—É—î –æ–¥–Ω–æ—á–∞—Å–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ —Ä–µ—Å—É—Ä—Å—É (–∞–Ω–∞–ª–æ–≥ ‚Äú–¥–æ–ø—É—Å–∫—É –¥–æ —Å–µ–∫—Ü—ñ—ó‚Äù).

üß© –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è:
–ó—Ä–æ–±–∏ fair —Å–µ–º–∞—Ñ–æ—Ä (new Semaphore(3, true)) ‚Äî —Ç–æ–¥—ñ –º–∞—à–∏–Ω–∏ —Å—Ç–æ—è—Ç–∏–º—É—Ç—å —É —á–µ—Å–Ω—ñ–π —á–µ—Ä–∑—ñ.

‚úÖ –ó–∞–≤–¥–∞–Ω–Ω—è 2: CountDownLatchRace ‚Äî –ì–æ–Ω–∫–∞ –ø—ñ—Å–ª—è –≤—ñ–¥–ª—ñ–∫—É

üìã –£–º–æ–≤–∞:
–Ñ 5 –±—ñ–≥—É–Ω—ñ–≤ —ñ –≤—ñ–¥–ª—ñ–∫ 3...2...1...GO!.
–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π CountDownLatch –¥–ª—è –æ–¥–Ω–æ—á–∞—Å–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç—É.

üîß –ü—ñ–¥–∫–∞–∑–∫–∞:

CountDownLatch startSignal = new CountDownLatch(1);
CountDownLatch doneSignal = new CountDownLatch(5);

for (int i = 1; i <= 5; i++) {
new Thread(() -> {
try {
startSignal.await();
System.out.println(Thread.currentThread().getName() + " started!");
Thread.sleep((int)(Math.random()*2000));
} catch (InterruptedException e) {}
finally { doneSignal.countDown(); }
}, "Runner-" + i).start();
}

Thread.sleep(1000);
System.out.println("3...2...1...GO!");
startSignal.countDown();
doneSignal.await();
System.out.println("Race finished!");


üí° –ú–µ—Ç–∞:
–í—ñ–¥—á—É–π, —â–æ await() ‚Äî —Ü–µ ‚Äú—á–µ–∫–∞—é —Å–∏–≥–Ω–∞–ª—É‚Äù, –∞ countDown() ‚Äî ‚Äú–∑–Ω—ñ–º–∞—é –æ–±–º–µ–∂–µ–Ω–Ω—è‚Äù.

üß© –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è:
–í–∏–º—ñ—Ä—è–π —á–∞—Å –≤—ñ–¥ –º–æ–º–µ–Ω—Ç—É ‚ÄúGO!‚Äù –¥–æ ‚ÄúRace finished!‚Äù —á–µ—Ä–µ–∑ System.currentTimeMillis().

‚úÖ –ó–∞–≤–¥–∞–Ω–Ω—è 3: CyclicBarrierTeam ‚Äî –ö–æ–º–∞–Ω–¥–Ω–∞ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —ñ —Å—Ç–∞—Ä—Ç

üìã –£–º–æ–≤–∞:
3 —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∏ –≥–æ—Ç—É—é—Ç—å—Å—è, –∫–æ–∂–µ–Ω —Ç—Ä–µ–Ω—É—î—Ç—å—Å—è 1‚Äì3 —Å–µ–∫—É–Ω–¥–∏,
–∞ –ø–æ—Ç—ñ–º —á–µ–∫–∞—é—Ç—å —É—Å—ñ—Ö –Ω–∞ –±–∞—Ä‚Äô—î—Ä—ñ, —ñ —Ç—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è —Ü—å–æ–≥–æ –¥—Ä—É–∫—É—é—Ç—å ‚ÄúWe start together!‚Äù.

üîß –ü—ñ–¥–∫–∞–∑–∫–∞:

CyclicBarrier barrier = new CyclicBarrier(3, () ->
System.out.println("=== All ready! START! ===")
);

for (int i = 1; i <= 3; i++) {
new Thread(() -> {
try {
Thread.sleep((int)(Math.random()*3000));
System.out.println(Thread.currentThread().getName() + " ready");
barrier.await();
} catch (Exception e) {}
}, "Athlete-" + i).start();
}


üí° –ú–µ—Ç–∞:
CyclicBarrier —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î –∫—ñ–ª—å–∫–∞ –ø–æ—Ç–æ–∫—ñ–≤, —è–∫—ñ –º–∞—é—Ç—å –æ–¥–Ω–æ—á–∞—Å–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω—É —Ñ–∞–∑—É.
(–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —É –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∏—Ö —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∞—Ö, –∫–æ–ª–∏ –≤—Å—ñ —á–∞—Å—Ç–∏–Ω–∏ –ø–æ–≤–∏–Ω–Ω—ñ –∑–∞–≤–µ—Ä—à–∏—Ç–∏ ‚Äú–µ—Ç–∞–ø‚Äù.)

üß© –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è:
–î–æ–¥–∞–π –ø–æ–≤—Ç–æ—Ä–Ω—É ‚Äú–ø—ñ–¥–≥–æ—Ç–æ–≤–∫—É‚Äù (—â–µ –æ–¥–∏–Ω —Ä–∞—É–Ω–¥ await()), —â–æ–± –ø–æ–∫–∞–∑–∞—Ç–∏ —Ü–∏–∫–ª—ñ—á–Ω—ñ—Å—Ç—å –±–∞—Ä‚Äô—î—Ä—É.

‚úÖ –ó–∞–≤–¥–∞–Ω–Ω—è 4: PhaserStages ‚Äî –ë–∞–≥–∞—Ç–æ—Ñ–∞–∑–Ω–∞ —Å–∏–º—É–ª—è—Ü—ñ—è

üìã –£–º–æ–≤–∞:
–°—Ç–≤–æ—Ä–∏ 3 –ø–æ—Ç–æ–∫–∏ (‚Äú—É—á–∞—Å–Ω–∏–∫–∏ –º—ñ—Å—ñ—ó‚Äù), —è–∫—ñ –º–∞—é—Ç—å –ø—Ä–æ–π—Ç–∏ —Ç—Ä–∏ —Ñ–∞–∑–∏:

–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞

–í–∏–∫–æ–Ω–∞–Ω–Ω—è

–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π Phaser, —â–æ–± –∫–æ–∂–µ–Ω –µ—Ç–∞–ø –ø–æ—á–∏–Ω–∞–≤—Å—è –ª–∏—à–µ —Ç–æ–¥—ñ, –∫–æ–ª–∏ –≤—Å—ñ –∑–∞–≤–µ—Ä—à–∏–ª–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π.

üîß –ü—ñ–¥–∫–∞–∑–∫–∞:

Phaser phaser = new Phaser(3);

Runnable task = () -> {
for (int phase = 0; phase < 3; phase++) {
System.out.println(Thread.currentThread().getName() + " Phase " + phase + " done");
phaser.arriveAndAwaitAdvance();
}
};


üí° –ú–µ—Ç–∞:
Phaser ‚Äî —Ü–µ –µ–≤–æ–ª—é—Ü—ñ–π–Ω–∞ —Ñ–æ—Ä–º–∞ CyclicBarrier, –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é –∫—ñ–ª—å–∫–æ—Ö —Ñ–∞–∑ —ñ –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ –ø—Ä–∏—î–¥–Ω–∞–Ω–Ω—è –ø–æ—Ç–æ–∫—ñ–≤.

üß© –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è:
–î–æ–¥–∞–π 4-–π ‚Äú—Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—á‚Äù-–ø–æ—Ç—ñ–∫, —è–∫–∏–π –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è (register()) –Ω–∞ –¥—Ä—É–≥—ñ–π —Ñ–∞–∑—ñ.

‚úÖ –ó–∞–≤–¥–∞–Ω–Ω—è 5: AwaitBarrierError ‚Äî –õ–æ–≥—ñ—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó

üìã –£–º–æ–≤–∞:
–°—Ç–≤–æ—Ä–∏ CyclicBarrier(3) —ñ –ª–∏—à–µ –¥–≤–∞ –ø–æ—Ç–æ–∫–∏, —è–∫—ñ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å await().
–ü–æ–±–∞—á, —â–æ –≤–æ–Ω–∏ –∑–∞–≤–∏—Å–Ω—É—Ç—å –Ω–∞–∑–∞–≤–∂–¥–∏.
–ü–æ—Ç—ñ–º –¥–æ–¥–∞–π —Ç—Ä–µ—Ç—å–æ–≥–æ –ø–æ—Ç–æ–∫—É —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥, —è–∫–∏–π —Ä–æ–∑–±–ª–æ–∫—É—î –±–∞—Ä‚Äô—î—Ä.

üí° –ú–µ—Ç–∞:
–ü–æ–±–∞—á–∏—Ç–∏ ‚Äú–ø–∞—Å—Ç–∫—É‚Äù: —è–∫—â–æ –Ω–µ –≤—Å—ñ –ø–æ—Ç–æ–∫–∏ –¥–æ—Å—è–≥–∞—é—Ç—å –±–∞—Ä‚Äô—î—Ä–∞ ‚Äî –ø—Ä–æ–≥—Ä–∞–º–∞ —á–µ–∫–∞—î –≤—ñ—á–Ω–æ.
–¶–µ –¥–æ–ø–æ–º–∞–≥–∞—î –≥–ª–∏–±—à–µ –∑—Ä–æ–∑—É–º—ñ—Ç–∏ –ø—Ä–∏–Ω—Ü–∏–ø —É–∑–≥–æ–¥–∂–µ–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥—É.

üß© –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è:
–î–æ–¥–∞–π —Ç–∞–π–º-–∞—É—Ç: barrier.await(5, TimeUnit.SECONDS) —ñ –æ–±—Ä–æ–±–∏ TimeoutException.

üí¨ –ü—ñ—Å–ª—è–º–æ–≤–∞

üß† –ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –º–æ–¥—É–ª—è —Ç–∏:

—É–º—ñ—î—à –±—É–¥—É–≤–∞—Ç–∏ —Å–∏—Å—Ç–µ–º–∏, –¥–µ –ø–æ—Ç–æ–∫–∏ –≤–∑–∞—î–º–æ–¥—ñ—é—Ç—å, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ ‚Äú–∂–∏–≤—É—Ç—å –æ–∫—Ä–µ–º–æ‚Äù;
–∫–µ—Ä—É—î—à –∫—ñ–ª—å–∫—ñ—Å—Ç—é –æ–¥–Ω–æ—á–∞—Å–Ω–∏—Ö —É—á–∞—Å–Ω–∏–∫—ñ–≤ (Semaphore);
—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î—à —Å—Ç–∞—Ä—Ç —ñ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è (CountDownLatch);
–∫–æ–æ—Ä–¥–∏–Ω—É—î—à –æ–¥–Ω–æ—á–∞—Å–Ω—ñ —Ñ–∞–∑–∏ (CyclicBarrier, Phaser);
—Ä–æ–∑—É–º—ñ—î—à, —è–∫ —É–Ω–∏–∫–∞—Ç–∏ –∑–∞–≤–∏—Å–∞–Ω—å —á–µ—Ä–µ–∑ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –æ—á—ñ–∫—É–≤–∞–Ω—å.