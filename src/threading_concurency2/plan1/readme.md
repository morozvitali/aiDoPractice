üßµ THREADS MODULE 01 ‚Äî Thread Creation & Basics

üéØ –ú–µ—Ç–∞ –º–æ–¥—É–ª—è:
–ó—Ä–æ–∑—É–º—ñ—Ç–∏, —è–∫ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è –ø–æ—Ç–æ–∫–∏, —è–∫ –≤–æ–Ω–∏ –ø—Ä–∞—Ü—é—é—Ç—å —É JVM, —â–æ —Ç–∞–∫–µ –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫,
join(), sleep() —ñ daemon, –∞ —Ç–∞–∫–æ–∂ –≤—ñ–¥—á—É—Ç–∏ –ø–µ—Ä—à—ñ –ø—Ä–æ—è–≤–∏ –Ω–µ–ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–æ—Å—Ç—ñ –ø—Ä–∏ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ–º—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—ñ.

‚úÖ –ó–∞–≤–¥–∞–Ω–Ω—è 1: DualRunner (A vs B)

üìã –£–º–æ–≤–∞:

–°—Ç–≤–æ—Ä–∏ –¥–≤–∞ –ø–æ—Ç–æ–∫–∏:

–æ–¥–∏–Ω –≤–∏–≤–æ–¥–∏—Ç—å "A" 100 —Ä–∞–∑—ñ–≤ —ñ–∑ –≤–∏–ø–∞–¥–∫–æ–≤–æ—é –∑–∞—Ç—Ä–∏–º–∫–æ—é;

—ñ–Ω—à–∏–π ‚Äî "B" 100 —Ä–∞–∑—ñ–≤ —ñ–∑ –≤–∏–ø–∞–¥–∫–æ–≤–æ—é –∑–∞—Ç—Ä–∏–º–∫–æ—é.

üîß –ü—ñ–¥–∫–∞–∑–∫–∞:

Thread t1 = new Thread(() -> {
for (int i = 0; i < 100; i++) {
System.out.print("A");
try { Thread.sleep((int)(Math.random() * 50)); } catch (InterruptedException e) {}
}
});

Thread t2 = new Thread(() -> {
for (int i = 0; i < 100; i++) {
System.out.print("B");
try { Thread.sleep((int)(Math.random() * 50)); } catch (InterruptedException e) {}
}
});

t1.start();
t2.start();
t1.join();
t2.join();
System.out.println("\nDone!");


üí° –ú–µ—Ç–∞:
–ü–æ–±–∞—á–∏—Ç–∏, —â–æ –ø–æ—Ä—è–¥–æ–∫ –≤–∏–≤–æ–¥—É "A" —Ç–∞ "B" —â–æ—Ä–∞–∑—É —Ä—ñ–∑–Ω–∏–π ‚Äî –∫–µ—Ä—É—î –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ –û–°, –Ω–µ –≤–∏.

üß© –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è:
–î–æ–¥–∞–π —Ç—Ä–µ—Ç—ñ–π –ø–æ—Ç—ñ–∫ "C", —è–∫–∏–π —á–µ–∫–∞—î –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –ø–µ—Ä—à–∏—Ö –¥–≤–æ—Ö —ñ —Ç–æ–¥—ñ –≤–∏–≤–æ–¥–∏—Ç—å "FINISHED".

‚úÖ –ó–∞–≤–¥–∞–Ω–Ω—è 2: ParallelCounter ‚Äî –†–æ–∑–¥—ñ–ª–µ–Ω–∏–π –ª—ñ—á–∏–ª—å–Ω–∏–∫

üìã –£–º–æ–≤–∞:
–°—Ç–≤–æ—Ä–∏ —Å–ø—ñ–ª—å–Ω–∏–π –ª—ñ—á–∏–ª—å–Ω–∏–∫ (int count = 0;)
—ñ –¥–≤–∞ –ø–æ—Ç–æ–∫–∏, —è–∫—ñ —ñ–Ω–∫—Ä–µ–º–µ–Ω—Ç—É—é—Ç—å –π–æ–≥–æ –ø–æ 1000 —Ä–∞–∑—ñ–≤ –∫–æ–∂–µ–Ω.
–í–∏–≤–µ–¥–∏ —Ñ—ñ–Ω–∞–ª—å–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è.

üîß –ü—ñ–¥–∫–∞–∑–∫–∞:

int[] counter = {0};
Runnable increment = () -> {
for (int i = 0; i < 1000; i++) counter[0]++;
};


üß† –û—á—ñ–∫—É–≤–∞–Ω–æ:
–†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –∑–∞–≤–∂–¥–∏ –±—É–¥–µ 2000 ‚Äî —á–µ—Ä–µ–∑ race condition.
–ü–æ—è—Å–Ω–µ–Ω–Ω—è —Ü—å–æ–≥–æ —Å—Ç–∞–Ω–µ —Ç–µ–º–æ—é –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –º–æ–¥—É–ª—è.

üß© –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è:
–î–æ–¥–∞–π Thread.sleep(1) —É—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ü–∏–∫–ª—É, —â–æ–± –ø—ñ–¥—Å–∏–ª–∏—Ç–∏ –ø—Ä–æ—è–≤ –∫–æ–ª—ñ–∑—ñ–π.

‚úÖ –ó–∞–≤–¥–∞–Ω–Ω—è 3: JoinControl ‚Äî –õ–∞–Ω—Ü—é–≥ –ø–æ—Ç–æ–∫—ñ–≤

üìã –£–º–æ–≤–∞:
–°—Ç–≤–æ—Ä–∏ —Ç—Ä–∏ –ø–æ—Ç–æ–∫–∏:

–ü–µ—Ä—à–∏–π –¥—Ä—É–∫—É—î "Start" ‚Üí —á–µ–∫–∞—î 1 —Å

–î—Ä—É–≥–∏–π —á–µ–∫–∞—î –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –ø–µ—Ä—à–æ–≥–æ (join()) —ñ –¥—Ä—É–∫—É—î "Middle"

–¢—Ä–µ—Ç—ñ–π —á–µ–∫–∞—î –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –¥—Ä—É–≥–æ–≥–æ —ñ –¥—Ä—É–∫—É—î "End"

üîß –ü—ñ–¥–∫–∞–∑–∫–∞:

Thread t1 = new Thread(() -> { ... });
Thread t2 = new Thread(() -> { t1.join(); ... });
Thread t3 = new Thread(() -> { t2.join(); ... });


üí° –ú–µ—Ç–∞:
–ü–æ–∫–∞–∑–∞—Ç–∏, —è–∫ –ø–æ—Ç–æ–∫–∏ –º–æ–∂—É—Ç—å —Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –ª–æ–≥—ñ—á–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫, —è–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è join().

üß© –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è:
–ó—Ä–æ–±–∏ –∑ —Ü—å–æ–≥–æ ‚Äú–µ—Ñ–µ–∫—Ç –¥—Ä—É–∫–∞—Ä—Å—å–∫–æ—ó –º–∞—à–∏–Ω–∫–∏‚Äù: Start ‚Üí ... ‚Üí Middle ‚Üí ... ‚Üí End.

‚úÖ –ó–∞–≤–¥–∞–Ω–Ω—è 4: DaemonPulse ‚Äî –î–µ–º–æ–Ω, —è–∫–∏–π –∂–∏–≤–µ –¥–æ—Ç–∏, –¥–æ–∫–∏ –∂–∏–≤–µ main

üìã –£–º–æ–≤–∞:
–°—Ç–≤–æ—Ä–∏ –¥–µ–º–æ–Ω-–ø–æ—Ç—ñ–∫, —è–∫–∏–π —Ä–∞–∑ –Ω–∞ —Å–µ–∫—É–Ω–¥—É –¥—Ä—É–∫—É—î "‚ô• heartbeat".
–ü–æ–∫–∏ –æ—Å–Ω–æ–≤–Ω–∏–π –ø–æ—Ç—ñ–∫ –ø—Ä–∞—Ü—é—î ‚Äî –≤—ñ–Ω –∂–∏–≤–µ.
–ö–æ–ª–∏ main –∑–∞–∫—ñ–Ω—á—É—î —Ä–æ–±–æ—Ç—É ‚Äî –¥–µ–º–æ–Ω –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.

üîß –ü—ñ–¥–∫–∞–∑–∫–∞:

Thread daemon = new Thread(() -> {
while (true) {
System.out.println("‚ô• heartbeat");
try { Thread.sleep(1000); } catch (InterruptedException e) {}
}
});
daemon.setDaemon(true);
daemon.start();
Thread.sleep(5000);
System.out.println("Main done!");


üí° –ú–µ—Ç–∞:
–ü–æ–±–∞—á–∏—Ç–∏ —Ä—ñ–∑–Ω–∏—Ü—é –º—ñ–∂ –∑–≤–∏—á–∞–π–Ω–∏–º —ñ –¥–µ–º–æ–Ω-–ø–æ—Ç–æ–∫–æ–º.

üß© –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è:
–î–æ–¥–∞–π –ª–æ–≥—ñ–∫—É, —â–æ–± –¥–µ–º–æ–Ω –∑—É–ø–∏–Ω—è–≤—Å—è –≤—Ä—É—á–Ω—É –ø—ñ—Å–ª—è —Å–∏–≥–Ω–∞–ª—É volatile boolean stop.

‚úÖ –ó–∞–≤–¥–∞–Ω–Ω—è 5: ThreadInspector ‚Äî –î–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –∂–∏–≤–∏—Ö –ø–æ—Ç–æ–∫—ñ–≤

üìã –£–º–æ–≤–∞:
–ó–∞–ø—É—Å—Ç–∏ 3 —Ä—ñ–∑–Ω–∏—Ö –ø–æ—Ç–æ–∫–∏ (–≤–∫–ª—é—á–Ω–æ –∑ –¥–µ–º–æ–Ω–æ–º),
–∞ –ø–æ—Ç—ñ–º –≤–∏–≤–µ–¥–∏ –≤—Å—ñ –∞–∫—Ç–∏–≤–Ω—ñ –ø–æ—Ç–æ–∫–∏ —á–µ—Ä–µ–∑ Thread.getAllStackTraces().keySet().

üîß –ü—ñ–¥–∫–∞–∑–∫–∞:

Set<Thread> threads = Thread.getAllStackTraces().keySet();
threads.forEach(t -> System.out.println(
t.getName() + " | " + (t.isDaemon() ? "daemon" : "user") + " | " + t.getState()
));


üí° –ú–µ—Ç–∞:
–ó—Ä–æ–∑—É–º—ñ—Ç–∏, —è–∫—ñ –ø–æ—Ç–æ–∫–∏ —Å—Ç–≤–æ—Ä—é—î JVM –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º (Finalizer, Reference Handler —Ç–æ—â–æ).
–¶–µ –¥–æ–ø–æ–º–æ–∂–µ –ø—ñ–∑–Ω—ñ—à–µ –ø—Ä–∏ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—ñ ExecutorService —ñ ForkJoinPool.

üß© –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è:
–ó—Ä–æ–±–∏ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –ø–æ—Ç–æ–∫—ñ–≤ –∑–∞ —Å—Ç–∞–Ω–æ–º (Thread.State) —ñ –ø–æ—Ä–∞—Ö—É–π, —Å–∫—ñ–ª—å–∫–∏ —ó—Ö —É –∫–æ–∂–Ω–æ–º—É —Å—Ç–∞–Ω—ñ.

üí¨ –ü—ñ—Å–ª—è–º–æ–≤–∞

üß† –ü—ñ—Å–ª—è –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è —Ü—å–æ–≥–æ –º–æ–¥—É–ª—è —Ç–∏:

–≤—ñ–ª—å–Ω–æ —Å—Ç–≤–æ—Ä—é—î—à —ñ –∫–µ—Ä—É—î—à –ø–æ—Ç–æ–∫–∞–º–∏;

—Ä–æ–∑—É–º—ñ—î—à, —è–∫ –ø—Ä–∞—Ü—é—î join() —ñ sleep();

–∑–Ω–∞—î—à, —â–æ –ø–æ—Ä—è–¥–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è ‚Äî –Ω–µ–ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–∏–π;

–ø–æ–±–∞—á–∏–≤ –ø–µ—Ä—à–∏–π –ø—Ä–æ—è–≤ race condition, —è–∫–∏–π –≤–∏–ø—Ä–∞–≤–∏–º–æ —É –º–æ–¥—É–ª—ñ 02.